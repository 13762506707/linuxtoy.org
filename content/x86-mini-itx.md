Title: 用 x86 Mini ITX 主板搭建智能路由
Date: 2014-05-04 13:09
Author: toy
Category: Tips
Slug: x86-mini-itx

{撰文/yang}

一直考虑要不要写一篇关于自己做的智能路由兼家用 NAS 的  
文章，主要是涉及到自己的文采以及这个所谓的 NAS 真的有  
点不太起眼——无论是从外观还是性能。

废话不说，步入正题。

有打算做个智能一点的路由器，市面上的路由器包含 USB 口  
的，甚至 SATA 口（某米路由）也有，不过价格有点离谱，  
而且自己有很多闲置的硬件，不想再乱花钱。遂打算自己 DIY  
一台。

[![itx](https://linuxtoy.org/img/2014/05/itx1-thumb.jpg)](https://linuxtoy.org/img/2014/05/itx1.jpg)

淘宝了好久，总算看上了一款板子，170 元，IONITX。这款  
索泰的离子主板，功耗低不说（我没有测试，不过电源适配  
器的额定才 60w），且能播放 1080p（9400M G 的 GPU），  
Atom 230，双通道 DDR2，关键是有 4 个 SATA 口以及 6 个  
USB 2.0 接口，（手头正好有闲置内存条和硬盘）正合我意。

买来后，开始着手安装了。

**硬件**

* 无线网卡：Atheros 9287  
* 硬盘：2 x 2.5 寸笔记本硬盘，1 块 Sandisk 8G SSD，1  
块 Sandisk 的 16G tf 卡  
* 内存：DDR2 667 X2 双通道  
* 视频：VGA（接到家里的电视上）  
* 音频：普通耳机插口线（接到家里的电视上）

**软件**

* hostapd  
* Samba  
* rsync  
* vsftpd  
* XBMC  
* usbmount  
* VirtualBox  
* NGINX  
* Sensors  
* hddtemp  
* Exim4  
* cron  
* curl

系统的话，用的是 Debian，安装到了 Sandisk 的 8G SSD 中。  
整个系统包含各种软件服务安装配置完毕后，占用了 2.6G 的  
空间。

把 MiniPCIe 的 Atheros 9287 网卡插好后，便可以配置 hostapd  
了，用这个可以做无线热点，非常稳定。因为我的网络上游是一个  
华为的 HG8120R 光猫路由，所以只需要在 Debian 上做好网络桥接  
即可直接使用光猫的 IP 段了。

Samba 主要用来配置 NAS 的共享目录，方便手机以及电脑等挂载浏览。

rsync 是主要的备份工具，因为我用了两张笔记本硬盘，用 cron  
每分钟检测 rsync 的同步状态，这样数据才能保险。

vsftpd 基本用不到，但是不装不行啊！谁个 NAS 没有个 FTP  
服务呢？

XBMC 吧，令我很纠结，各种插件都不太稳定，直播看电影忒麻烦。  
但是 DLNA 还是非常方便的，另外播放本地 1080p 也很不错。

usbmount，自动挂载 U 盘的。有时候免不了插个 U 盘，另外在  
Samba 中已经映射了 U 盘自动挂载的目录，这样方便其他客户端  
比如 Windows 直接在线访问。

VirtualBox？这个要用到，我因为经常用到百度云，系统是 Linux 的，  
离线下载东西不太方便，虽然有各种各样的离线下载脚本，但是还是  
不如百度管家的推送功能好用。VirtualBox 下安装精简 XP 系统，  
安装百度云管家，直接映射下载目录为 NAS 共享目录，远程推送即可。

NGINX，搭建了 WebDAV 的服务端，在 iPhone 上用 photosync 来备份  
照片视频等。

snesors、hddtemp，监控温度的。

Exim4，定时用 cron 自动发送日志，比如备份、花生壳域名解析状态等。

cron，不多说了。

curl？用来解析花生壳二级域名，Web 认证的方式。

16G 的 Sandisk Class 10 TF 卡用来干什么？百度推送离线下载  
高清电影的，看完后清空即可。我不太喜欢保存电影啊，太费空间了。

经过上面的各种服务，一台所谓的智能路由器便搭建完毕了，还附  
带有 NAS 的功能。关键是功耗极低，满载温度为 33℃ 左右。

平常是这样使用的：白天的时候，在办公室可以远程推送百度云里  
的电影等等，回到家用 hostapda 搭建的无线环境上网，打开电视  
便可以用 XBMC 播放推送下载的视频，到了夜间自动备份数据，还  
可定时关机。平常手机拍摄的照片还可以自动备份上传到 WebDAV  
中，家里的平板和电脑都可以访问 Samba 共享的目录。

缺点也有，就是有点丑，我没弄机箱。另外 Atheros 9287 是 300M  
的，局域网无线传输速度不咋滴，实际拷贝速度能达到 19M 左右。  
想换成双频网卡，价格能买台二手主板了。

其实用树莓派或其他的 ARM 主机也可以做到，不过基本没有 SATA 口  
和 MiniPCIe 口，另外我觉得 x86 性能好一些，而且能跑虚拟机。  
Atom 的 CPU 就够用了。

对了，有没有看到上面的图片中有一根飞线从主机中跑了出来？  
其实那是条 WiFi 天线 :-)

[![itx](https://linuxtoy.org/img/2014/05/itx2-thumb.jpg)](https://linuxtoy.org/img/2014/05/itx2.jpg)
